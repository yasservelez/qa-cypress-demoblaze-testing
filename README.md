# Cypress Test Automation Framework

Cypress test automation framework built with JavaScript (JS) to implement the UI and API tests for OpenCart E-commerce store.

> If you are a beginner to Cypress, refer to my other repo to refresh your Cypress knowledge which will serve as a starting-point to Cypress testing:
[Cypress-E2E-Web-and-API-Testing](https://github.com/hersannfonseca/qa-demoblaze-testing)

Application Under Test:
https://www.demoblaze.com/

## Setup üõ†Ô∏è

### Pre-requisites

* Install NodeJS and NPM pakcage manager.
* Code Editor of your choice e.g. Visual Studio Code
  * Install [ESLint](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint) VS Code extension from Microsoft to make linting work in IDE
* GIT Client (for remote tracking)
* GIT Bash terminal (for Windows)

#### Optional
* Install [Cypress Snippets](https://marketplace.visualstudio.com/items?itemName=CliffSu.cypress-snippets) VS Code Extension that includes the most common cypress snippets.

### Setup from Scratch

* `npm init` to setup node project with package.json
* `npm install --save-dev cypress` to install cypress as dev dependency
* `npx cypress open` to open the cypress test runner and choose `E2E Testing` which will create cypress config, support and fixture folders.
* Choose browser of your choice, and scaffold examples which will create boilerplate specs within e2e folder.
* Remove the default boilerplate specs from `cypress/e2e` folder
* Add `.gitignore` to exclude files and folders from GIT
* Add `README.md` to document
* Start with writing tests under `cypress/e2e` directory.

#### Integrating ESLint

* Install [ESLint](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint) VS Code extension from Microsoft to make linting work in IDE
* Install eslint in project `npm init @eslint/config --save-dev`
* Install [Cypress ESLint Plugin](https://www.npmjs.com/package/eslint-plugin-cypress) with `npm install eslint-plugin-cypress --save-dev`
* Configure the `.eslintsrc.json` to use recommended settings or add custom rules:
```json
{
  "extends": [
    "plugin:cypress/recommended"
  ]
}
```
* [Linting Cypress code using ESLint and eslint-plugin-cypress](https://www.youtube.com/watch?v=-YgitwmwFo0)

### Using existing framework

* Clone git repo
* Navigate to folder and open terminal
* Run `npm install` to install the framework dependencies

#### Pre-requistes 

* Add the `projectId` for Cypress Cloud in `cypress.config.js`
* Add the `cypress key` for Cypress Cloud in `package.json`
  
> To add IntelliSense for IDE like VS Code, add the [Triple slash directives](https://docs.cypress.io/guides/tooling/IDE-integration#Triple-slash-directives) to the head of test file or use the [Refernce type declaration via jsconfig.json](https://docs.cypress.io/guides/tooling/IDE-integration#Triple-slash-directives)

---

## Running tests ‚ö°

* [Command Line](https://docs.cypress.io/guides/guides/command-line)
* `npx cypress open` will open the cypress test runner so you can run the tests from it
* `npx cypress run` will run all the test spec files located within `cypress/e2e` folder. By default test are run in headless mode on electron browser.
* Following custom test scripts are setup in `package.json` to run specific test suites in headless format:
  * `npm run cy:run`
  * `npm run cy:open`
  * `npm run cy:run-ci`
---

## Test Reporting üìë

* This framework uses [cypress-mochawesome-reporter](https://www.npmjs.com/package/cypress-mochawesome-reporter) to generate HTML test reports.
* Add the following options to `cypress.config.js`
  ```js
   //cypress-mochawesome-reporter
  reporter: 'cypress-mochawesome-reporter',  
  reporterOptions: {
    charts: true, //Genarates Chart in HTML report
    reportPageTitle: 'OpenCart Test Report', //Report title will be set to the mentioned string
    embeddedScreenshots: true, //Screenshot will be embedded within the report
    inlineAssets: true, //No separate assets folder will be created
    videoOnFailOnly: false, //If Videos are recorded and added to the report, setting this to true will add the videos only to tests with failures.
  },
  ```
* HTML Reports are generated by default in `root/cypress/reports` folder.
* It embeds the screenshots of tests on failure automatically to the report, and also attaches the videos to report. 
* It also allows the customization of report with better control of how and where report is generated.
* This is how the report dashboard looks like:

* Some ther reporting possibilities are:
  * [mochawesome](https://www.npmjs.com/package/mochawesome)
  
* If a test case is failed, then the assertion error, screenshot and video gets attached to report automatically. 
  * When a test retries, Cypress will continue to take screenshots for each failed attempt or cy.screenshot() and suffix each new screenshot with (attempt n), corresponding to the current retry attempt number.

---

## Cypress Cloud ‚òÅÔ∏è

* Record a run to see your test results in Cypress Cloud. You can then optimize your test suite, debug failing and flaky tests, Test Replay, watch video, view console output and screenshots, and integrate with your favorite tools.
* [Cypress Cloud documentation](https://docs.cypress.io/guides/cloud/introduction)
* [Cypress Project ID and Record Key](https://docs.cypress.io/guides/cloud/account-management/projects)
* [Record tests](https://docs.cypress.io/guides/continuous-integration/introduction#Record-tests)
  * Once you set up your project to record, Cypress generates a unique projectId for your project and automatically insert it into your Cypress configuration file. The projectId is a 6 character string in your Cypress configuration.
  * The record key is used to authenticate that your project is allowed to record tests to Cypress Cloud. As long as your record key stays private, no one will be able to record test runs for your project - even if they have your projectId.
  * Create `cypress.env.json` in root directory that Cypress will automatically check. Values in here will overwrite conflicting environment variables in your Cypress configuration.This strategy is useful because if you add cypress.env.json to your `.gitignore` file, the values in here can be different for each developer machine.
  ```json
  {
    "projectId": ""
  }
  ```

* Run the test via `npx cypress run --record --key <record key>`

---

## Continuous Integration CI üöÄ

The Project is configured to run Cypress in Continuous Integration with multiple CI Providers.

### Jenkins Integration

* This framework supports the Continous Integration CI with Jenkins, and offers fully customize execution with support for:
  * Jenkinsfile Pipeline Script
  * Build with Parameters
    * Allows to select test specs, browser, browser mode, tags, environment, dashboard recording.
  * Publishes Mochawesome HTML report via HTML Publisher Plugin
  * Parses JUnit XML results to display a summary and trends of test results
  * Sends a Slack Notification with test results summary, link to test report, and job.
* See the [Jenkinsfile](./Jenkinsfile) to see how the pipeline is configured.